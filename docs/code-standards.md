# Codebase Structure and Code Standards - chat-media-view

## Codebase Structure

The `chat-media-view` library follows a modular structure designed for clarity, maintainability, and scalability.

```
.
├── src/                  # Source code for the library
│   ├── components/       # React components (e.g., ChatMediaView, Lightbox)
│   ├── hooks/            # Custom React hooks (e.g., useIntersectionObserver)
│   ├── utils/            # Utility functions (e.g., GridLayoutEngine)
│   ├── styles/           # Component-specific styles (e.g., image-grid.css, lightbox.css)
│   ├── types.ts          # TypeScript type definitions (e.g., MediaItem)
│   ├── accessibility.ts  # Accessibility utilities
│   ├── thumbhash.ts      # Placeholder for ThumbHash related utilities
│   └── index.ts          # Main entry point for the library
├── stories/              # Storybook stories for components (e.g., ChatImageGrid.stories.tsx, Lightbox.stories.tsx)
├── docs/                 # Project documentation
│   ├── codebase-summary.md
│   ├── project-overview-pdr.md
│   ├── code-standards.md
│   └── system-architecture.md
├── .storybook/           # Storybook configuration
├── dist/                 # Compiled output (generated by Vite)
├── node_modules/         # Node.js dependencies
├── package.json          # Project metadata and dependencies
├── tsconfig.json         # TypeScript configuration
├── tsconfig.build.json   # TypeScript build configuration
├── vite.config.ts        # Vite build configuration
├── eslint.config.js     # ESLint 9 configuration
├── postcss.config.js     # PostCSS configuration
├── tailwind.config.js    # Tailwind CSS configuration
└── README.md             # Project README
```

## Code Standards and Best Practices

### 1. TypeScript Usage
- **Strict Typing**: Use TypeScript rigorously to ensure type safety. The project enforces strict mode (`"strict": true`) in `tsconfig.json`.
- **Explicit Types**: Explicitly define types for function arguments, return values, and complex state where inference is not clear.
- **Interfaces for Objects**: Use interfaces for defining object shapes and props (e.g., `MediaItem`).
- **Strict Checks**: Adhere to the following strict TypeScript compiler options:
    - `noUncheckedIndexedAccess`: Ensures explicit checks for `undefined` when accessing array elements by index.
    - `exactOptionalPropertyTypes`: Guarantees precise handling of optional properties.
    - `noImplicitThis`: Flags `this` expressions with an implied `any` type.
    - `noImplicitAny`: Disallows implicitly `any` typed expressions and declarations.
- **`useEffect` Return Types**: Ensure `useEffect` hooks return either `void` or a cleanup function (`() => void`).

### 2. React Component Guidelines
- **Functional Components**: Prefer functional components with React Hooks.
- **Props Destructuring**: Destructure props at the component's top level for clarity.
- **Meaningful Naming**: Use clear and descriptive names for components, props, and state variables.
- **Prop Types (TypeScript)**: Rely on TypeScript interfaces for prop type checking.
- **State Management**: Use `useState` and `useReducer` for local component state. For global state, consider context API or a lightweight state management library if necessary.
- **Side Effects**: Manage side effects using `useEffect`. Ensure proper dependency arrays to prevent unnecessary re-renders or stale closures.

### 3. Styling
- **CSS Files**: Utilize dedicated CSS files (e.g., `image-grid.css`, `lightbox.css`) for component-specific styling.
- **Utility-First**: Consider using utility-first CSS frameworks like Tailwind CSS for rapid UI development, configured via `tailwind.config.js`.
- **Variables**: Use CSS variables for themes, colors, and common spacing.
- **Design Tokens**: Follow a strict naming convention for CSS custom properties: `--[component]-[category]-[property]` (e.g., `--lightbox-color-overlay`, `--lightbox-blur-bg`).
- **Glassmorphism**: When implementing glassmorphism, always provide a fallback for browsers that do not support `backdrop-filter` using `@supports not (backdrop-filter: blur(1px))`.
- **Transitions**: Standardize transitions using CSS variables to ensure consistency across interactive elements (e.g., `--lightbox-transition-normal`).

### 4. Naming Conventions
- **Files**: `PascalCase` for React components (`ComponentName.tsx`), `camelCase` for hooks and utilities (`useHookName.ts`, `utilityFunction.ts`). Storybook files are `ComponentName.stories.tsx`.
- **Variables & Functions**: `camelCase`.
- **Constants**: `SCREAMING_SNAKE_CASE` for global constants.
- **Interfaces & Types**: `PascalCase`.

### 5. Error Handling
- **Boundary Components**: Implement error boundary components for gracefully handling rendering errors in React (if applicable for a library of this scope).
- **Meaningful Errors**: Provide clear error messages for debugging and user feedback.

### 6. Testing
- **Storybook**: Utilize Storybook (`.stories.tsx` files) for isolated component development, visual testing, and interactive documentation. `autodocs` are enabled for automatic documentation generation within Storybook.
- **Unit Tests**: Use a testing framework (e.g., Vitest) and React Testing Library for unit testing components and utility functions.
- **Coverage**: Strive for high test coverage for critical components and logic.

### 7. Documentation
- **Inline Comments**: Use comments for complex logic or explanations that aren't immediately obvious from the code.
- **JSDoc**: Use JSDoc for functions, components, and interfaces to generate API documentation.
- **Markdown Docs**: Maintain external documentation (like this file) in the `docs/` directory.
- **README.md**: Keep the main `README.md` up-to-date with installation, usage, and API reference.

### 8. Performance
- **Memoization**: Use `React.memo`, `useMemo`, and `useCallback` to optimize performance for expensive computations or re-renders.
- **Lazy Loading**: Implement lazy loading for components or media (e.g., `useIntersectionObserver` for media items).

### 9. Linting

This project uses ESLint 9 with TypeScript-ESLint for code quality:

```bash
npm run lint        # Check for issues
npm run lint:fix    # Auto-fix issues
npm run lint:strict # Zero warnings allowed
```

Key rules enforced:
- Explicit return types on exported functions
- Type-only imports for types
- No unsafe any operations
- React hooks rules

### 10. Version Control
- **Git Flow**: Follow a standard Git branching strategy (e.g., feature branches, develop, main).
- **Commit Messages**: Write clear, concise, and descriptive commit messages (e.g., Conventional Commits).
